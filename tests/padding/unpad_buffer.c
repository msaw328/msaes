#include <stdint.h>
#include <string.h>

#include "msaes/padding.h"

int main() {
    // 1 byte of padding
    uint8_t padded_data1[16] = {
        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12,
        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x80
    };

    uint8_t expected_data1[15] = {
        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12,
        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12
    };

    uint8_t data1[15] = { 0 };

    aes_unpad_buffer(padded_data1, data1, 15);

    if(memcmp(data1, expected_data1, 15) != 0) return 1;

    // Buffer on block boundary
    uint8_t padded_data2[32] = {
        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12,
        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12,
        0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    uint8_t expected_data2[16] = {
        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12,
        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12
    };

    uint8_t data2[16] = { 0 };

    aes_unpad_buffer(padded_data2, data2, 16);

    if(memcmp(data2, expected_data2, 16) != 0) return 2;

    // Random buffer
    uint8_t padded_data3[16] = {
        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12,
        0x12, 0x12, 0x12, 0x12, 0x12, 0x80, 0x00, 0x00
    };

    uint8_t expected_data3[13] = {
        0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12,
        0x12, 0x12, 0x12, 0x12, 0x12
    };

    uint8_t data3[13] = { 0 };

    aes_unpad_buffer(padded_data3, data3, 13);

    if(memcmp(data3, expected_data3, 13) != 0) return 3;

    return 0;
}
